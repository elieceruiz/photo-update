<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script>
      // Envía un objeto a Streamlit (como string JSON)
      const send = (data) => {
        Streamlit.setComponentValue(JSON.stringify(data));
      };

      function success(pos) {
        const data = {
          lat: pos.coords.latitude,
          lon: pos.coords.longitude,
          accuracy: pos.coords.accuracy
        };
        send(data);
      }

      function error(err) {
        const data = { error: err.message || err.code };
        send(data);
      }

      // Cuando cargue el iframe, pedimos ubicación
      window.onload = function () {
        if (!navigator.geolocation) {
          send({ error: "Este navegador no soporta geolocalización" });
        } else {
          navigator.geolocation.getCurrentPosition(success, error, {
            enableHighAccuracy: true,
            timeout: 10000,  // ⏱️ máximo 10 seg
            maximumAge: 0
          });
        }
      };

      // Boilerplate de integración con Streamlit
      function onRender(event) {
        Streamlit.setFrameHeight(0); // altura mínima, invisible
      }
      Streamlit.events.addEventListener(Streamlit.RENDER_EVENT, onRender);
      Streamlit.setComponentReady();
    </script>
  </head>
  <body></body>
</html>
